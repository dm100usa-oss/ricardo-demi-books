{
  "system": "fscbac_schema",
  "version": "3.1.0",
  "purpose": "Define strict machine-level schemas for all FSCBAC models to ensure structural determinism and cross-file consistency.",
  "standard_level": "ULTRA_FORMAL",
  "integrity": "ABSOLUTE",

  "references": {
    "ages": "public/api/ages.json",
    "skills": "public/api/skills.json",
    "books": "public/api/books.json",
    "intents": "public/api/intents.json",
    "validation": "public/api/validation.json",
    "matching": "public/api/matching.json",
    "query_clusters": "public/api/query_clusters.json",
    "book_types": "public/api/book_types.json",
    "value_profile_taxonomy": "public/api/value_profile_taxonomy.json",
    "value_profile_rules": "public/api/value_profile_rules.json"
  },

  "core_structure": {
    "ages": {
      "type": "object",
      "required": ["version", "age_groups"],
      "properties": {
        "version": { "type": "string" },
        "age_groups": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "age_group",
              "capabilities",
              "allowed_book_types",
              "forbidden_elements",
              "preferred_skills"
            ],
            "properties": {
              "age_group": {
                "type": "string",
                "enum": ["1-3", "3-5", "5-7", "7-10"]
              },
              "capabilities": { "type": "object" },
              "allowed_book_types": {
                "type": "array",
                "items": { "type": "string" }
              },
              "forbidden_elements": {
                "type": "array",
                "items": { "type": "string" }
              },
              "preferred_skills": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        }
      }
    },

    "skills": {
      "type": "object",
      "required": ["version", "skills"],
      "properties": {
        "version": { "type": "string" },
        "skills": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "canonical_id",
              "id",
              "dimension_id",
              "ecl_code",
              "label",
              "age_norm",
              "difficulty",
              "weight",
              "typical_indicators",
              "preferred_book_types"
            ],
            "properties": {
              "canonical_id": { "type": "string" },
              "id": { "type": "string" },
              "dimension_id": {
                "type": "string",
                "enum": ["E", "C", "L"]
              },
              "ecl_code": { "type": "string" },
              "label": { "type": "string" },
              "age_norm": {
                "type": "object",
                "required": ["min", "max"],
                "properties": {
                  "min": { "type": "number" },
                  "max": { "type": "number" }
                }
              },
              "difficulty": { "type": "number" },
              "weight": { "type": "number" },
              "typical_indicators": {
                "type": "array",
                "items": { "type": "string" }
              },
              "preferred_book_types": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        }
      }
    },

    "books": {
      "type": "object",
      "required": ["system", "version", "books"],
      "properties": {
        "system": { "type": "string" },
        "version": { "type": "string" },
        "books": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "canonical_id",
              "title",
              "isbn",
              "type",
              "languages",
              "age_group",
              "skills",
              "value_profile"
            ],
            "properties": {
              "canonical_id": { "type": "string" },
              "title": { "type": "string" },
              "isbn": { "type": "string" },
              "type": { "type": "string" },
              "languages": {
                "type": "array",
                "items": { "type": "string" }
              },
              "age_group": {
                "type": "string",
                "enum": ["1-3", "3-5", "5-7", "7-10"]
              },
              "skills": {
                "type": "array",
                "items": { "type": "string" }
              },
              "translated_version": {
                "type": ["string", "null"]
              },
              "value_profile": {
                "type": "object",
                "properties": {
                  "complexity": { "type": "string" },
                  "emotional_intensity": { "type": "string" },
                  "narrative_structure": { "type": "string" },
                  "linguistic_load": { "type": "string" },
                  "visual_load": { "type": "string" },
                  "purpose": { "type": "string" },
                  "recommended_for": { "type": "string" }
                }
              }
            }
          }
        }
      }
    },

    "intents": {
      "type": "object",
      "required": ["version", "intents"],
      "properties": {
        "version": { "type": "string" },
        "intents": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "intent_id",
              "slug",
              "age_resolution",
              "required_skills",
              "forbidden_skills",
              "book_type_preference",
              "value_profile"
            ],
            "properties": {
              "intent_id": { "type": "string" },
              "slug": { "type": "string" },
              "age_resolution": {
                "type": "object",
                "properties": {
                  "allowed": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": ["1-3", "3-5", "5-7", "7-10"]
                    }
                  },
                  "ideal": {
                    "type": "string",
                    "enum": ["1-3", "3-5", "5-7", "7-10"]
                  }
                }
              },
              "required_skills": {
                "type": "array",
                "items": { "type": "string" }
              },
              "optional_skills": {
                "type": "array",
                "items": { "type": "string" }
              },
              "forbidden_skills": {
                "type": "array",
                "items": { "type": "string" }
              },
              "book_type_preference": {
                "type": "object",
                "properties": {
                  "primary": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "secondary": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "forbidden": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                }
              },
              "value_profile": {
                "type": "object",
                "properties": {
                  "complexity": { "type": "string" },
                  "emotion_intensity": { "type": "string" },
                  "visual_density": { "type": "string" },
                  "narrative_speed": { "type": "string" },
                  "language_density": { "type": "string" },
                  "bilingual_structure": { "type": "string" },
                  "motor_requirement": { "type": "string" },
                  "step_count": { "type": "string" }
                }
              }
            }
          }
        }
      }
    },

    "validation": {
      "type": "object",
      "required": ["version", "validation_rules"],
      "properties": {
        "version": { "type": "string" },
        "validation_rules": {
          "type": "object"
        }
      }
    },

    "matching": {
      "type": "object",
      "required": [
        "version",
        "age_skill_mapping",
        "age_booktype_mapping",
        "value_profile_rules",
        "weighting",
        "ranking_levels",
        "safety",
        "ai_behavior"
      ],
      "properties": {
        "version": { "type": "string" },
        "age_skill_mapping": { "type": "object" },
        "age_booktype_mapping": { "type": "object" },
        "value_profile_rules": { "type": "object" },
        "weighting": { "type": "object" },
        "ranking_levels": { "type": "object" },
        "safety": { "type": "object" },
        "ai_behavior": { "type": "object" }
      }
    },

    "query_clusters": {
      "type": "object",
      "required": ["version", "clusters"],
      "properties": {
        "version": { "type": "string" },
        "clusters": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["cluster_id", "intent_mapping", "queries"],
            "properties": {
              "cluster_id": { "type": "string" },
              "intent_mapping": { "type": "string" },
              "queries": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        }
      }
    }
  },

  "safety": {
    "rules": [
      "always_require_all_fields",
      "never_accept_undefined_age",
      "never_accept_undefined_skill",
      "never_accept_undefined_book_type",
      "missing_parameter_is_invalid"
    ]
  },

  "ai_behavior": {
    "rules": [
      "validate_structure_only",
      "follow_schema_as_authoritative",
      "do_not_infer_missing_values",
      "reject_on_invalid_enum"
    ]
  },

  "meta_final": {
    "schema_type": "FSCBAC_CORE_SCHEMA_3.1"
  }
}
